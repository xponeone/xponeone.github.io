<html>
    <head>
        <title>X-Plane Library Finder</title>
        <meta charset="utf-8">
        <meta name="referrer" content="unsafe-url" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/0.3.2/js/sql.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    </head>
    <body>
        <h1 style="margin: 0 auto; width: 50vw; min-width: 300px; padding-top: 20vh;">Library Finder</h1>
        <h6 id="version" style="margin: 0 auto; width: 50vw; min-width: 300px; color: lightgray; padding-top: 10vh;">db ver:</h6>
        <div class="input-group mb-3" style="margin: 0 auto; width: 50vw; min-width: 300px;">
            <input class="form-control" type="text" id="path" placeholder="virtual/path/to/find.obj">
            <button class="btn btn-outline-secondary" type="button" onclick="find();">search</button>
        </div>
        <div style="margin: 0 auto; width: 50vw; min-width: 300px; text-align: right;">
            <a href="#desc">
                <h6>how to use</h6>
            </a>
        </div>
        <div style="margin: 0 auto; width: 50vw; padding-top: 10vh; padding-bottom: 10vh; min-width: 300px;">
            <h3>Result</h3>
            <p id="error" style="color: red;"></p>
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">library</th>
                    </tr>
                </thead>
                <tbody id="result">
                </tbody>
            </table>
        </div>
        <div style="margin: 0 auto; width: 300px; height: 250px;">
            <ins class="kakao_ad_area" style="display:none;" data-ad-unit="DAN-3cpp4ngzEKGTCkAx" data-ad-width="300" data-ad-height="250"></ins>
        </div>
        <div id="desc" style="margin: 0 auto; width: 50vw; min-width: 300px; padding-top: 10vh; padding-bottom: 30vh;">
            <div style="padding-bottom: 100px;">
                <h3>What is the virtual path?</h3>
                <h3>virtual path가 무엇인가요?</h3>
                <hr>
                <h6>Library files work by mapping <b>virtual paths</b> to files in the scenery package. One <b>virtual path</b> can be mapped to multiple graphic resources; in many cases X-Plane will randomly pick between the choices to create more scenery variety.</h6>
                <br>
                <h6>라이브러리 파일은 시너리 패키지의 파일을 <b>virtual path</b>에 맵핑하여 작동합니다. 하나의 <b>virtual path</b>는 여러 개의 그래픽 리소스에 맵핑할 수 있습니다. 이 경우 X-Plane은 시너리의 다양성을 위해 랜덤하게 선택합니다.</h6>
            </div>
            <div style="padding-bottom: 100px;">
                <h3>How can I find the virtual path of missing library?</h3>
                <h3>어떻게 누락된 라이브러리의 virtual path를 찾을 수 있나요?</h3>
                <hr>
                <h6>If an error occurs due to missing library, you can check the <b>virtual path</b> that failed to load in Log.txt. <b>Virtual path</b> can be easily found by searching with keywords such as "Failed to find resource", "Unable to locate object".</h6>
                <br>
                <h6>라이브러리 누락으로 인해 에러가 발생한 경우, Log.txt에서 로딩에 실패한 <b>virtual path</b>를 확인할 수 있습니다. <b>virtual path</b>는 "Failed to find resource", "Unable to locate object" 등의 키워드로 검색하면 쉽게 찾을 수 있습니다.</h6>
            </div>
            <div>
                <h3>How to use?</h3>
                <h3>어떻게 사용하나요?</h3>
                <hr>
                <h6>When you enter the desired <b>virtual path</b>(e.g., MisterX_Library/Airport/Aircraft/Airbus_A220_100/Delta.obj) in the input and click the "find" button, a table will be displayed showing in which library that <b>virtual path</b> is included. Some <b>virtual paths</b> may contained in multiple libraries.</h6>
                <h6>찾고자 하는 <b>virtual path</b>(예: MisterX_Library/Airport/Aircraft/Airbus_A220_100/Delta.obj)를 입력창에 적고 "find" 버튼을 누르면 어떤 라이브러리에 그 <b>virtual path</b>포함되어 있는지 표로 출력됩니다. 일부 <b>virtual path</b>는 복수 개의 라이브러리에 포함되어 있을 수 있습니다.</h6>
            </div>
        </div>
        <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
        <script>
            let db;
            fetch('library.db').then(response => response.arrayBuffer()).then(buffer => {
                db = new SQL.Database(new Uint8Array(buffer));
                document.getElementById('version').innerText += db.exec("SELECT * FROM info")[0]['values'][0][1];
            });

            function find() {
                const path = document.getElementById('path').value;
                var resp = db.exec("SELECT lib FROM lib_all WHERE path='" + path + "'")[0];
                if(resp) {
                    document.getElementById('error').innerText = '';
                    document.getElementById('result').innerHTML = '';
                    resp = resp['values']
                    for(const i in resp) {
                        document.getElementById('result').innerHTML += '<tr><th scope="row">' + i + '</th><td>' + resp[i] + '</td></tr>';
                    }
                    return;
                }
                document.getElementById('error').innerText = 'No library found matching input.';
                document.getElementById('result').innerHTML = '';
            }
        </script>
    </body>
</html>
